{"version":3,"file":"useFieldGroup.cjs","sources":["../../src/useFieldGroup.tsx"],"sourcesContent":["'use client'\n\nimport { useState } from 'react'\nimport { useStore } from '@tanstack/react-store'\nimport { FieldGroupApi, functionalUpdate } from '@tanstack/form-core'\nimport { useIsomorphicLayoutEffect } from './useIsomorphicLayoutEffect'\nimport type {\n  AnyFieldGroupApi,\n  DeepKeysOfType,\n  FieldGroupState,\n  FieldsMap,\n  FormAsyncValidateOrFn,\n  FormValidateOrFn,\n} from '@tanstack/form-core'\nimport type { AppFieldExtendedReactFormApi } from './createFormHook'\nimport type {\n  ComponentType,\n  FunctionComponent,\n  PropsWithChildren,\n  ReactNode,\n} from 'react'\nimport type { LensFieldComponent } from './useField'\n\nfunction LocalSubscribe({\n  lens,\n  selector,\n  children,\n}: PropsWithChildren<{\n  lens: AnyFieldGroupApi\n  selector: (state: FieldGroupState<any>) => FieldGroupState<any>\n}>): ReturnType<FunctionComponent> {\n  const data = useStore(lens.store, selector)\n\n  return <>{functionalUpdate(children, data)}</>\n}\n\n/**\n * @private\n */\nexport type AppFieldExtendedReactFieldGroupApi<\n  TFormData,\n  TFieldGroupData,\n  TFields extends\n    | DeepKeysOfType<TFormData, TFieldGroupData | null | undefined>\n    | FieldsMap<TFormData, TFieldGroupData>,\n  TOnMount extends undefined | FormValidateOrFn<TFormData>,\n  TOnChange extends undefined | FormValidateOrFn<TFormData>,\n  TOnChangeAsync extends undefined | FormAsyncValidateOrFn<TFormData>,\n  TOnBlur extends undefined | FormValidateOrFn<TFormData>,\n  TOnBlurAsync extends undefined | FormAsyncValidateOrFn<TFormData>,\n  TOnSubmit extends undefined | FormValidateOrFn<TFormData>,\n  TOnSubmitAsync extends undefined | FormAsyncValidateOrFn<TFormData>,\n  TOnDynamic extends undefined | FormValidateOrFn<TFormData>,\n  TOnDynamicAsync extends undefined | FormAsyncValidateOrFn<TFormData>,\n  TOnServer extends undefined | FormAsyncValidateOrFn<TFormData>,\n  TSubmitMeta,\n  TFieldComponents extends Record<string, ComponentType<any>>,\n  TFormComponents extends Record<string, ComponentType<any>>,\n> = FieldGroupApi<\n  TFormData,\n  TFieldGroupData,\n  TFields,\n  TOnMount,\n  TOnChange,\n  TOnChangeAsync,\n  TOnBlur,\n  TOnBlurAsync,\n  TOnSubmit,\n  TOnSubmitAsync,\n  TOnDynamic,\n  TOnDynamicAsync,\n  TOnServer,\n  TSubmitMeta\n> &\n  NoInfer<TFormComponents> & {\n    AppField: LensFieldComponent<\n      TFieldGroupData,\n      TSubmitMeta,\n      NoInfer<TFieldComponents>\n    >\n    AppForm: ComponentType<PropsWithChildren<{}>>\n    /**\n     * A React component to render form fields. With this, you can render and manage individual form fields.\n     */\n    Field: LensFieldComponent<TFieldGroupData, TSubmitMeta>\n\n    /**\n     * A `Subscribe` function that allows you to listen and react to changes in the form's state. It's especially useful when you need to execute side effects or render specific components in response to state updates.\n     */\n    Subscribe: <TSelected = NoInfer<FieldGroupState<TFieldGroupData>>>(props: {\n      selector?: (state: NoInfer<FieldGroupState<TFieldGroupData>>) => TSelected\n      children: ((state: NoInfer<TSelected>) => ReactNode) | ReactNode\n    }) => ReturnType<FunctionComponent>\n  }\n\nexport function useFieldGroup<\n  TFormData,\n  TFieldGroupData,\n  TFields extends\n    | DeepKeysOfType<TFormData, TFieldGroupData | null | undefined>\n    | FieldsMap<TFormData, TFieldGroupData>,\n  TOnMount extends undefined | FormValidateOrFn<TFormData>,\n  TOnChange extends undefined | FormValidateOrFn<TFormData>,\n  TOnChangeAsync extends undefined | FormAsyncValidateOrFn<TFormData>,\n  TOnBlur extends undefined | FormValidateOrFn<TFormData>,\n  TOnBlurAsync extends undefined | FormAsyncValidateOrFn<TFormData>,\n  TOnSubmit extends undefined | FormValidateOrFn<TFormData>,\n  TOnSubmitAsync extends undefined | FormAsyncValidateOrFn<TFormData>,\n  TOnDynamic extends undefined | FormValidateOrFn<TFormData>,\n  TOnDynamicAsync extends undefined | FormAsyncValidateOrFn<TFormData>,\n  TOnServer extends undefined | FormAsyncValidateOrFn<TFormData>,\n  TComponents extends Record<string, ComponentType<any>>,\n  TFormComponents extends Record<string, ComponentType<any>>,\n  TSubmitMeta = never,\n>(opts: {\n  form:\n    | AppFieldExtendedReactFormApi<\n        TFormData,\n        TOnMount,\n        TOnChange,\n        TOnChangeAsync,\n        TOnBlur,\n        TOnBlurAsync,\n        TOnSubmit,\n        TOnSubmitAsync,\n        TOnDynamic,\n        TOnDynamicAsync,\n        TOnServer,\n        TSubmitMeta,\n        TComponents,\n        TFormComponents\n      >\n    | AppFieldExtendedReactFieldGroupApi<\n        // Since this only occurs if you nest it within other form lenses, it can be more\n        // lenient with the types.\n        unknown,\n        TFormData,\n        string | FieldsMap<unknown, TFormData>,\n        any,\n        any,\n        any,\n        any,\n        any,\n        any,\n        any,\n        any,\n        any,\n        any,\n        TSubmitMeta,\n        TComponents,\n        TFormComponents\n      >\n  fields: TFields\n  defaultValues?: TFieldGroupData\n  onSubmitMeta?: TSubmitMeta\n  formComponents: TFormComponents\n}): AppFieldExtendedReactFieldGroupApi<\n  TFormData,\n  TFieldGroupData,\n  TFields,\n  TOnMount,\n  TOnChange,\n  TOnChangeAsync,\n  TOnBlur,\n  TOnBlurAsync,\n  TOnSubmit,\n  TOnSubmitAsync,\n  TOnDynamic,\n  TOnDynamicAsync,\n  TOnServer,\n  TSubmitMeta,\n  TComponents,\n  TFormComponents\n> {\n  const [formLensApi] = useState(() => {\n    const api = new FieldGroupApi(opts)\n    const form =\n      opts.form instanceof FieldGroupApi\n        ? (opts.form.form as AppFieldExtendedReactFormApi<\n            TFormData,\n            TOnMount,\n            TOnChange,\n            TOnChangeAsync,\n            TOnBlur,\n            TOnBlurAsync,\n            TOnSubmit,\n            TOnSubmitAsync,\n            TOnDynamic,\n            TOnDynamicAsync,\n            TOnServer,\n            TSubmitMeta,\n            TComponents,\n            TFormComponents\n          >)\n        : opts.form\n\n    const extendedApi: AppFieldExtendedReactFieldGroupApi<\n      TFormData,\n      TFieldGroupData,\n      TFields,\n      TOnMount,\n      TOnChange,\n      TOnChangeAsync,\n      TOnBlur,\n      TOnBlurAsync,\n      TOnSubmit,\n      TOnSubmitAsync,\n      TOnDynamic,\n      TOnDynamicAsync,\n      TOnServer,\n      TSubmitMeta,\n      TComponents,\n      TFormComponents\n    > = api as never\n\n    extendedApi.AppForm = function AppForm(appFormProps) {\n      return <form.AppForm {...appFormProps} />\n    }\n\n    extendedApi.AppField = function AppField(props) {\n      return (\n        <form.AppField {...(formLensApi.getFormFieldOptions(props) as any)} />\n      )\n    }\n\n    extendedApi.Field = function Field(props) {\n      return <form.Field {...(formLensApi.getFormFieldOptions(props) as any)} />\n    }\n\n    extendedApi.Subscribe = function Subscribe(props: any) {\n      return (\n        <LocalSubscribe\n          lens={formLensApi}\n          selector={props.selector}\n          children={props.children}\n        />\n      )\n    }\n\n    return Object.assign(extendedApi, {\n      ...opts.formComponents,\n    }) as AppFieldExtendedReactFieldGroupApi<\n      TFormData,\n      TFieldGroupData,\n      TFields,\n      TOnMount,\n      TOnChange,\n      TOnChangeAsync,\n      TOnBlur,\n      TOnBlurAsync,\n      TOnSubmit,\n      TOnSubmitAsync,\n      TOnDynamic,\n      TOnDynamicAsync,\n      TOnServer,\n      TSubmitMeta,\n      TComponents,\n      TFormComponents\n    >\n  })\n\n  useIsomorphicLayoutEffect(formLensApi.mount, [formLensApi])\n\n  return formLensApi\n}\n"],"names":["jsx","useIsomorphicLayoutEffect"],"mappings":";;;;;;;;AAuBA;AAAwB;AACtB;AACA;AAEF;AAIE;AAEA;AACF;AA6DO;AA+EL;AACE;AACA;AAoBA;AAmBA;AACE;AAAuC;AAGzC;AACE;AACsE;AAIxE;AACE;AAAwE;AAG1E;AACE;AACEA;AAAC;AAAA;AACO;AACU;AACA;AAAA;AAAA;AAKtB;AAAkC;AACxB;AACT;AAoBHC;AAEA;AACF;;"}